{"componentChunkName":"component---src-templates-resource-detail-index-jsx","path":"/blog/docker-network-analyze","result":{"data":{"locales":{"edges":[{"node":{"ns":"translation","data":"{\"Documentation\":\"文档\",\"FAQ\":\"常见问题\",\"NEXT\":\"下一页\",\"PREV\":\"上一页\",\"Product List\":\"应用列表\",\"ALL\":\"全部\",\"No relevant data found\":\"未找到相关数据\",\"Get it Now\":\"立即获取\",\"Overview\":\"概述\",\"Highlights\":\"亮点\",\"Description\":\"详情\",\"Related Applications\":\"相关应用\",\"Learning Materials\":\"学习资料\",\"Classification\":\"分类\",\"Os\":\"系统\",\"Open Source License\":\"开源许可\",\"Support Language\":\"支持语言\",\"Languages\":\"编程语言\",\"Solution\":\"场景方案\",\"Resource\":\"资源\",\"Applicable Personnel\":\"适用人员\",\"Resource List\":\"资源列表\",\"Official Website\":\"官网\",\"Feedback\":\"沟通反馈\",\"Submit A Suggestion\":\"提交此应用的建议\",\"Get Professional Services\":\"获取专业服务\",\"Tags\":\"关键词\",\"Author\":\"作者\",\"Related Reading\":\"相关阅读\",\"Resource Center\":\"资源中心\",\"Challengeg\":\"挑战\",\"How do we solve it?\":\"我们如何解决?\",\"More solution\":\"更多方案\",\"Type of asset\":\"类型\",\"Categories\":\"类别\",\"Resource Download\":\"资料下载\",\"Discover Now\":\"阅读详情\",\"Become a Partner\":\"成为伙伴\",\"Invoicing\":\"开具发票\",\"7×24 Tickets\":\"7×24 工单\",\"BROWSE ALL\":\"浏览所有\",\"Services List\":\"服务列表\",\"Service Type\":\"服务类别\",\"Service Object\":\"服务对象\",\"Content directory\":\"内容目录\",\"mo\":\"月\",\"y\":\"年\",\"Benefit\":\"好处\",\"What do we do\":\"我们怎么做\",\"Cases\":\"案例\",\"Purchase and price\":\"购买与价格\",\"Service portfolio\":\"服务组合\",\"Related Services\":\"相关服务\",\"Business insight\":\"业务洞察\",\"Components\":\"相关组件\",\"Copyright\":\"© 2022 长沙网久软件有限公司版权所有 备案：<a href='https://beian.miit.gov.cn/#/Integrated/index'>湘ICP备16009117号</a>\",\"Company summary\":\"为用户提供简单的云原生应用，帮助软件开发商构建基于全球云计算的在线商业体系\",\"Applications\":\"相关应用\",\"SHARE\":\"分享至\"}","language":"zh-CN"}}]},"site":{"siteMetadata":{"copyright":"Copyright","description":"Company summary","siteUrl":"https://www.websoft9.com","socials":[{"icon":"fab fa-github social-link-icon","id":1,"link":"https://github.com/","title":"github"},{"icon":"fab fa-twitter social-link-icon","id":2,"link":"https://www.twitter.com","title":"Twitter"},{"icon":"fab fa-instagram social-link-icon","id":3,"link":"https://www.instagram.com","title":"Instagram"},{"icon":"fab fa-linkedin social-link-icon","id":4,"link":"https://www.linkedin.com","title":"Linkedin"},{"icon":"fab fa-pinterest social-link-icon","id":5,"link":"https://pinterest.com","title":"Pinterest"}]}},"RelatedReading":{"nodes":[{"id":"bd9e2836-aedb-556f-91d5-eb23e91e8891","slug":"digtal-committee-start-changsha","title":"数字经济专业委员会在长沙成立，Websoft9 助力传统企业转型","time":null,"image":"https://libs.websoft9.com/Websoft9/resource/blog/2022/10/digtal-commit-start-cs.jpg","type":{"id":"c0003798-cdad-534f-af28-121e7d8278cb","key":"news","title":"新闻"}},{"id":"045c8c29-4e09-5f29-bbed-b29d211615fb","slug":"software-supply-chain","title":"软件供应链","time":null,"image":"https://libs.websoft9.com/Websoft9/resource/solution/softwarescm-feature-websoft9.png","type":{"id":"ffbb8d0c-2d15-5add-9a32-4e36e353a203","key":"solution","title":"解决方案"}},{"id":"17c4039d-5e09-55dc-9bc8-c19dfb8eff6c","slug":"open-knowledge-base","title":"知识协作","time":null,"image":"https://libs.websoft9.com/Websoft9/resource/solution/open-km-hero-websoft9.webp","type":{"id":"ffbb8d0c-2d15-5add-9a32-4e36e353a203","key":"solution","title":"解决方案"}}]},"allContentfulResource":{"nodes":[{"id":"b4aac38b-c0be-5eda-a883-e1b227272059","slug":"docker-network-analyze","title":"Docker 网络解读","description":null,"image":null,"type":{"id":"0a810898-e829-5004-8809-ea2fb20621d4","key":"blog","title":"博客"},"author":[{"id":"8dce9d8a-0d75-5062-a1d6-75d09e764908","title":"CEO","fullName":"Websoft9","pictureUrl":"https://libs.websoft9.com/Websoft9/logo/person/cdl.jpeg","customer":null}],"content":{"id":"baeec1b4-5123-5f2d-aa03-d3009108641c","content":"Docker 容器在运行时，会涉及多个容器相互连接，甚至与宿主机上的应用连接的问题。既然需要产生连接，那么就必然要依赖网络。  \n\n网络在Docker的技术体系中，是一个不容易搞清楚的要点。因此，希望您读完本文之后，对 Docker 网络有一个通透的理解。\n\n## 网络定义\n\n首先，我们花几分钟的时间，回顾网络是什么。\n\n网络不仅仅是计算机术语，在我们的生活中，网络无处不在。\n\n任何一个被称之为网络的事物都是由“终端节点+中心节点”组成。如果多个小的网络联合起来，就组成了大网络。\n\n![](https://libs.websoft9.com/Websoft9/blog/zh/2020/09/what-is-network-hub-websoft9.png)\n\n* 在计算机网络中这个中心节点可被称之为：网桥或交换机或HUB。  \n* 在快递业网络中这个中心节点可被称之为：转运中心或中心仓\n* 在人际关系网络这个中心节点可被称之为：核心人物或有影响力的人\n* 在陆地的水网中这个中心节点可被称之为：湖泊或多河交汇处\n* 在太阳系网络中这个中心节点可以被成为：太阳\n\n这里有一个概念值得注意，不管是是终端节点还是中心节点，它们都是节点。即它们的“物理属性”是一个层面，而逻辑上的分工又不是一个层面。\n\n节点与节点连接起来，就组成网络。中心节点对（网络）内起着与其他终端节点沟通的作用，对（网络）外起着与外部连接的功能，甚至是连接外部的唯一通道。\n\n其实，只要能够分辨清楚哪些是终端节点，哪些是中心节点，就完全从宏观上把握住了网络。剩下的，就是搞清楚它们之间的数据流向。\n\n## Docker 网络\n\n为了了解 Docker 网络，我们先在已经运行 Docker 的主机上运行一条命令 `docker network ls`\n```\n[root@iZ8vb7iZ ~]# docker network ls\nNETWORK ID          NAME                      DRIVER              SCOPE\n06008f57697f        blogwebsoft9com_default   bridge              local\nf13768fd7a20        bridge                    bridge              local\n7d6412aa6e40        host                      host                local\ne5e6049b8d9f        none                      null                local\n29eae24dae84        portainer_default         bridge              local\nb286f40bc93d        websoft9com_default       bridge              local\n```\n\n以上显示的就是 Docker 管辖的所有中心节点网卡（先不称之为网络）名称。而容器内部也有网卡，但不会在此命令中列出。\n\n> 网卡也被称之为网络接口\n\nDocker 的网络中，每一个运行中的容器就是网络中的终端节点，这个很好理解。\n\n**那么谁是 Docker 网络的中心节点呢？**\n\n要正确理解这个问题，先熟悉一个 Docker 网络相关的设计：在安装 Docker 时，Docker 会自动创建三个（虚拟）中心节点网卡，同时宿主机上创建一个名称为 docker0 的（虚拟）中心网卡。\n\n下面分别介绍 Docker 内部的三个网卡：\n\n1. Bridge 网卡（默认）：如果创建容器的时候选择连接此网卡，Docker 会为每一个容器分配、设置IP等，并通过宿主机的 docker0 网卡与外部通信。\n  ```\n  sudo docker run -it  phpmyadmin\n  ```\n2. host 网卡：如果创建容器的时候选择连接此网卡，Docker 不会为容器创建网卡和IP地址，而是直接使用宿主机的IP和端口。\n  ```\n  sudo docker run -it --net=\"host\" phpmyadmin\n  ```\n\n3. None 网卡：如果创建容器的时候选择连接此网卡，则以为着 Docker 关闭了容器的网络功能。\n\n如果您读到此处，仍然一知半解，我想可能需要向您澄清一个概念。\n\n**网卡、中心节点和网络**\n\n网络上绝大部分关于 Docker 网络相关的博客，都没有仔细斟酌网络这个词的用法，不该出现的“网络”的地方错用了这个词，很容易让读者无法理解本质。\n\n所以我们再回顾一次：\n\n* **网卡**：用户与外部通信的计算机网络组建，它可以是虚拟的，也可以是物理上存在看得见的网卡。在现在这个软件定义网络的时代，网卡一般都是虚拟的。但不管是哪种形式的网卡，通过`ifconfig`命令查看，可知其格式基本一致\n    ```\n\n    docker0: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500\n            inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255\n            inet6 fe80::42:f6ff:fead:46  prefixlen 64  scopeid 0x20<link>\n            ether 02:42:f6:ad:00:46  txqueuelen 0  (Ethernet)\n            RX packets 2831  bytes 2150398 (2.0 MiB)\n            RX errors 0  dropped 0  overruns 0  frame 0\n            TX packets 2406  bytes 682422 (666.4 KiB)\n            TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\n    eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n            inet 172.26.72.241  netmask 255.255.240.0  broadcast 172.26.79.255\n            inet6 fe80::216:3eff:fe0a:e07c  prefixlen 64  scopeid 0x20<link>\n            ether 00:16:3e:0a:e0:7c  txqueuelen 1000  (Ethernet)\n            RX packets 1146393  bytes 760158453 (724.9 MiB)\n            RX errors 0  dropped 0  overruns 0  frame 0\n            TX packets 836693  bytes 355058824 (338.6 MiB)\n            TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n    ```\n\n* **中心节点**：网卡中有一种特殊网卡，我们称之为中心节点网卡或网桥，其他的网卡都与之相连，由它负责内部网卡之间的通信和外部的通信出口中转。\n\n* **网络**：多个网卡之间通过某种形式组合起来，可以按设计进行通信，就形成了网络。网络一般采用“中心节点+多个终端节点”的组网模式。\n\n## 端口\n\n容器中端口与服务器的端口是一个概念。\n\n端口即应用程序在网卡中占用的访问通道。例如：一个容器中安装了 Apache 和 MySQL 两个软件，而这个容器只有一个虚拟网卡，如何保证两个软件都可以被外界访问又互不干扰？\n\n计算机的设计者会给网卡虚拟很多访问通道，并给与从0到65535的数字编号，这个编号就是端口。需要用到网络通道的软件可以配置不同的数字编号，比如：Apache 使用 80 端口，MySQL 使用 3306 端口。\n\n拿一个真实世界的例子可能更有助于理解端口。\n\n比如去一栋办公大楼（只有一个门牌地址），如何保证各种不同的人群安全有序的进出？\n一般来说，管理非常规范的办公楼可能会有：员工通道（001号门）、访客通道（002号门）、消防通道（003号门）、物流通道（004号门）等各种不同的门，不同的人群通过不同的通道进出，其中每一个门就相当于一个端口。\n\n## 外网访问\n\n理解了上面的 Docker 网络模式之后，在设置 Docker 容器被外网访问就变得非常简单。\n\n常见的容器通信常见包括：\n\n* 容器之间通信\n* 容器与宿主机通信\n* 容器直接与外部网络通信\n\n## 常见问题\n\n#### 容器互联 -link 有什么作用？\n\n用于在两个容器之间创建一个之间连接的虚拟通道（在 /etc/hosts 文件中增加被连接的容器名称和IP信息），而不必通过网桥连接。\n\n#### 可以直接修改 iptable 实现容器的外网访问控制吗？\n\n可以，但是比较复杂。\n\n#### 创建容器的时候，不指定容器的网卡名称系统会自动命名吗？\n\n会。一般以当前目录文件夹名称+default，例如：blogwebsoft9com_default 这个网卡的名称来源于在blog.websoft9.com目录下基于 docker-compose 创建容器\n\n#### docker-compose 启动容器（组）会自动创建中心网卡吗？\n\n会\n\n#### docker run 启动容器会自动创建网卡吗？\n\n不会，默认使用已经存在的 bridge\n\n#### docker network ls 查看到的网卡与宿主机下 ifconfig 有什么联系？\n\ndocker network ls 查看到的网卡也会被显示到宿主机下","childMarkdownRemark":{"html":"<p>Docker 容器在运行时，会涉及多个容器相互连接，甚至与宿主机上的应用连接的问题。既然需要产生连接，那么就必然要依赖网络。</p>\n<p>网络在Docker的技术体系中，是一个不容易搞清楚的要点。因此，希望您读完本文之后，对 Docker 网络有一个通透的理解。</p>\n<h2>网络定义</h2>\n<p>首先，我们花几分钟的时间，回顾网络是什么。</p>\n<p>网络不仅仅是计算机术语，在我们的生活中，网络无处不在。</p>\n<p>任何一个被称之为网络的事物都是由“终端节点+中心节点”组成。如果多个小的网络联合起来，就组成了大网络。</p>\n<p><img src=\"https://libs.websoft9.com/Websoft9/blog/zh/2020/09/what-is-network-hub-websoft9.png\" alt=\"\"></p>\n<ul>\n<li>在计算机网络中这个中心节点可被称之为：网桥或交换机或HUB。</li>\n<li>在快递业网络中这个中心节点可被称之为：转运中心或中心仓</li>\n<li>在人际关系网络这个中心节点可被称之为：核心人物或有影响力的人</li>\n<li>在陆地的水网中这个中心节点可被称之为：湖泊或多河交汇处</li>\n<li>在太阳系网络中这个中心节点可以被成为：太阳</li>\n</ul>\n<p>这里有一个概念值得注意，不管是是终端节点还是中心节点，它们都是节点。即它们的“物理属性”是一个层面，而逻辑上的分工又不是一个层面。</p>\n<p>节点与节点连接起来，就组成网络。中心节点对（网络）内起着与其他终端节点沟通的作用，对（网络）外起着与外部连接的功能，甚至是连接外部的唯一通道。</p>\n<p>其实，只要能够分辨清楚哪些是终端节点，哪些是中心节点，就完全从宏观上把握住了网络。剩下的，就是搞清楚它们之间的数据流向。</p>\n<h2>Docker 网络</h2>\n<p>为了了解 Docker 网络，我们先在已经运行 Docker 的主机上运行一条命令 <code>docker network ls</code></p>\n<pre><code>[root@iZ8vb7iZ ~]# docker network ls\nNETWORK ID          NAME                      DRIVER              SCOPE\n06008f57697f        blogwebsoft9com_default   bridge              local\nf13768fd7a20        bridge                    bridge              local\n7d6412aa6e40        host                      host                local\ne5e6049b8d9f        none                      null                local\n29eae24dae84        portainer_default         bridge              local\nb286f40bc93d        websoft9com_default       bridge              local\n</code></pre>\n<p>以上显示的就是 Docker 管辖的所有中心节点网卡（先不称之为网络）名称。而容器内部也有网卡，但不会在此命令中列出。</p>\n<blockquote>\n<p>网卡也被称之为网络接口</p>\n</blockquote>\n<p>Docker 的网络中，每一个运行中的容器就是网络中的终端节点，这个很好理解。</p>\n<p><strong>那么谁是 Docker 网络的中心节点呢？</strong></p>\n<p>要正确理解这个问题，先熟悉一个 Docker 网络相关的设计：在安装 Docker 时，Docker 会自动创建三个（虚拟）中心节点网卡，同时宿主机上创建一个名称为 docker0 的（虚拟）中心网卡。</p>\n<p>下面分别介绍 Docker 内部的三个网卡：</p>\n<ol>\n<li>Bridge 网卡（默认）：如果创建容器的时候选择连接此网卡，Docker 会为每一个容器分配、设置IP等，并通过宿主机的 docker0 网卡与外部通信。</li>\n</ol>\n<pre><code>sudo docker run -it  phpmyadmin\n</code></pre>\n<ol start=\"2\">\n<li>host 网卡：如果创建容器的时候选择连接此网卡，Docker 不会为容器创建网卡和IP地址，而是直接使用宿主机的IP和端口。</li>\n</ol>\n<pre><code>sudo docker run -it --net=\"host\" phpmyadmin\n</code></pre>\n<ol start=\"3\">\n<li>None 网卡：如果创建容器的时候选择连接此网卡，则以为着 Docker 关闭了容器的网络功能。</li>\n</ol>\n<p>如果您读到此处，仍然一知半解，我想可能需要向您澄清一个概念。</p>\n<p><strong>网卡、中心节点和网络</strong></p>\n<p>网络上绝大部分关于 Docker 网络相关的博客，都没有仔细斟酌网络这个词的用法，不该出现的“网络”的地方错用了这个词，很容易让读者无法理解本质。</p>\n<p>所以我们再回顾一次：</p>\n<ul>\n<li>\n<p><strong>网卡</strong>：用户与外部通信的计算机网络组建，它可以是虚拟的，也可以是物理上存在看得见的网卡。在现在这个软件定义网络的时代，网卡一般都是虚拟的。但不管是哪种形式的网卡，通过<code>ifconfig</code>命令查看，可知其格式基本一致</p>\n<pre><code>\ndocker0: flags=4099&#x3C;UP,BROADCAST,MULTICAST>  mtu 1500\n        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255\n        inet6 fe80::42:f6ff:fead:46  prefixlen 64  scopeid 0x20&#x3C;link>\n        ether 02:42:f6:ad:00:46  txqueuelen 0  (Ethernet)\n        RX packets 2831  bytes 2150398 (2.0 MiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 2406  bytes 682422 (666.4 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\neth0: flags=4163&#x3C;UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 172.26.72.241  netmask 255.255.240.0  broadcast 172.26.79.255\n        inet6 fe80::216:3eff:fe0a:e07c  prefixlen 64  scopeid 0x20&#x3C;link>\n        ether 00:16:3e:0a:e0:7c  txqueuelen 1000  (Ethernet)\n        RX packets 1146393  bytes 760158453 (724.9 MiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 836693  bytes 355058824 (338.6 MiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n</code></pre>\n</li>\n<li>\n<p><strong>中心节点</strong>：网卡中有一种特殊网卡，我们称之为中心节点网卡或网桥，其他的网卡都与之相连，由它负责内部网卡之间的通信和外部的通信出口中转。</p>\n</li>\n<li>\n<p><strong>网络</strong>：多个网卡之间通过某种形式组合起来，可以按设计进行通信，就形成了网络。网络一般采用“中心节点+多个终端节点”的组网模式。</p>\n</li>\n</ul>\n<h2>端口</h2>\n<p>容器中端口与服务器的端口是一个概念。</p>\n<p>端口即应用程序在网卡中占用的访问通道。例如：一个容器中安装了 Apache 和 MySQL 两个软件，而这个容器只有一个虚拟网卡，如何保证两个软件都可以被外界访问又互不干扰？</p>\n<p>计算机的设计者会给网卡虚拟很多访问通道，并给与从0到65535的数字编号，这个编号就是端口。需要用到网络通道的软件可以配置不同的数字编号，比如：Apache 使用 80 端口，MySQL 使用 3306 端口。</p>\n<p>拿一个真实世界的例子可能更有助于理解端口。</p>\n<p>比如去一栋办公大楼（只有一个门牌地址），如何保证各种不同的人群安全有序的进出？\n一般来说，管理非常规范的办公楼可能会有：员工通道（001号门）、访客通道（002号门）、消防通道（003号门）、物流通道（004号门）等各种不同的门，不同的人群通过不同的通道进出，其中每一个门就相当于一个端口。</p>\n<h2>外网访问</h2>\n<p>理解了上面的 Docker 网络模式之后，在设置 Docker 容器被外网访问就变得非常简单。</p>\n<p>常见的容器通信常见包括：</p>\n<ul>\n<li>容器之间通信</li>\n<li>容器与宿主机通信</li>\n<li>容器直接与外部网络通信</li>\n</ul>\n<h2>常见问题</h2>\n<h4>容器互联 -link 有什么作用？</h4>\n<p>用于在两个容器之间创建一个之间连接的虚拟通道（在 /etc/hosts 文件中增加被连接的容器名称和IP信息），而不必通过网桥连接。</p>\n<h4>可以直接修改 iptable 实现容器的外网访问控制吗？</h4>\n<p>可以，但是比较复杂。</p>\n<h4>创建容器的时候，不指定容器的网卡名称系统会自动命名吗？</h4>\n<p>会。一般以当前目录文件夹名称+default，例如：blogwebsoft9com_default 这个网卡的名称来源于在blog.websoft9.com目录下基于 docker-compose 创建容器</p>\n<h4>docker-compose 启动容器（组）会自动创建中心网卡吗？</h4>\n<p>会</p>\n<h4>docker run 启动容器会自动创建网卡吗？</h4>\n<p>不会，默认使用已经存在的 bridge</p>\n<h4>docker network ls 查看到的网卡与宿主机下 ifconfig 有什么联系？</h4>\n<p>docker network ls 查看到的网卡也会被显示到宿主机下</p>"}},"persons":null,"customers":null,"products":null,"solutions":null,"tags":null,"time":"2020-09-08","downloadUrl":null}]}},"pageContext":{"slug":"docker-network-analyze","breadcrumb":{"location":"/blog/docker-network-analyze","crumbs":[{"pathname":"/","crumbLabel":"Home"},{"pathname":"/blog","crumbLabel":"blog"},{"pathname":"/blog/docker-network-analyze","crumbLabel":"docker-network-analyze"}]},"language":"zh-CN","i18n":{"language":"zh-CN","languages":["en-US","zh-CN"],"defaultLanguage":"zh-CN","generateDefaultLanguagePage":false,"routed":false,"originalPath":"/blog/docker-network-analyze","path":"/blog/docker-network-analyze"}}},"staticQueryHashes":["2390569662","3367695531","3666294474","3881056605","931386620"]}